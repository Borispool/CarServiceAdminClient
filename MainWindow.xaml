<Window x:Class="CarServiceAdminClient.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:viewModels="clr-namespace:CarServiceAdminClient.ViewModels"
        xmlns:System="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        d:DataContext="{d:DesignInstance Type=viewModels:MainViewModel}"
        Title="Система адміністрування сервісу"
        Height="650" Width="1100" MinHeight="600" MinWidth="1000"
        WindowStartupLocation="CenterScreen" Closing="MainWindow_Closing">
    <Grid>
        <Grid.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                <GradientStop Color="#F4F7F6" Offset="0.0" />
                <GradientStop Color="#E6E9EB" Offset="1.0" />
            </LinearGradientBrush>
        </Grid.Background>

        <Grid>
            <Grid.Style>
                <Style TargetType="Grid">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding ActiveView}" Value="Clients">
                            <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Grid.Style>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="400" MinWidth="350"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Background="White" CornerRadius="8,0,0,8">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="Керування Клієнтами" Style="{StaticResource HeaderStyle}"/>

                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBlock Text="Сортувати:" VerticalAlignment="Center" Margin="0,0,5,0" Foreground="#555"/>
                        <ComboBox ItemsSource="{Binding ClientSortOptions}"
                                  SelectedItem="{Binding SelectedClientSortOption}"
                                  MinWidth="150"/>
                    </StackPanel>

                    <StackPanel Grid.Row="2" Margin="0,0,0,15">
                        <TextBlock Text="Пошук (Прізвище, Телефон):" Margin="0,0,0,5" Foreground="#555"/>
                        <TextBox Text="{Binding ClientSearchText, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>

                    <ListBox Grid.Row="3" ItemsSource="{Binding ClientsView}" SelectedItem="{Binding SelectedClient}" Style="{StaticResource ClientListBoxStyle}" HorizontalContentAlignment="Stretch">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Margin="10">
                                    <TextBlock Text="{Binding FullName}" FontWeight="Bold" FontSize="15" Foreground="#333"/>
                                    <TextBlock Text="{Binding PhoneNumber}" Foreground="#777" FontSize="12"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <StackPanel Grid.Row="4" Orientation="Horizontal" Margin="0,15,0,0">
                        <Button Content="Додати" Command="{Binding AddClientCommand}"/>
                        <Button Content="Редагувати" Command="{Binding EditClientCommand}"/>
                        <Button Content="Видалити" Command="{Binding DeleteClientCommand}"/>
                    </StackPanel>
                </Grid>
            </Border>

            <Grid Grid.Column="1">
                <TextBlock Text="Оберіть клієнта зі списку, щоб переглянути деталі"
                           Style="{StaticResource PlaceholderTextStyle}"
                           Visibility="{Binding SelectedClient, Converter={StaticResource InverseNullToVisibilityConverter}}"/>

                <Border Style="{StaticResource DetailsCardStyle}" Visibility="{Binding SelectedClient, Converter={StaticResource NullToVisibilityConverter}}">
                    <Grid>
                        <Button Content="Вихід" Style="{StaticResource ExitButtonStyle}"
                                Command="{Binding ExitApplicationCommand}"
                                HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,15,15,0" />

                        <StackPanel Margin="30">
                            <TextBlock Text="Повне ім'я:" Style="{StaticResource LabelTextStyle}"/>
                            <TextBlock Text="{Binding SelectedClient.FullName}" Style="{StaticResource DataTextStyle}" Margin="0,0,0,15"/>
                            <TextBlock Text="ID Клієнта:" Style="{StaticResource LabelTextStyle}"/>
                            <TextBlock Text="{Binding SelectedClient.Id}" Style="{StaticResource DataTextStyle}" Margin="0,0,0,15"/>
                            <TextBlock Text="Телефон:" Style="{StaticResource LabelTextStyle}"/>
                            <TextBlock Text="{Binding SelectedClient.PhoneNumber}" Style="{StaticResource DataTextStyle}" Margin="0,0,0,15"/>
                            <TextBlock Text="Email:" Style="{StaticResource LabelTextStyle}"/>
                            <TextBlock Text="{Binding SelectedClient.Email}" Style="{StaticResource DataTextStyle}" Margin="0,0,0,15"/>
                            <TextBlock Text="Персональна знижка:" Style="{StaticResource LabelTextStyle}" Margin="0,10,0,0"/>
                            <TextBlock Text="{Binding CurrentClientDiscount}" Style="{StaticResource DataTextStyle}" Foreground="Green" FontWeight="Bold"/>
                            <TextBlock Text="Дії з клієнтом:" Style="{StaticResource LabelTextStyle}" Margin="0,20,0,0"/>
                            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                <Button Content="Автомобілі Клієнта" Command="{Binding ShowCarsViewCommand}" />
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <Grid>
            <Grid.Style>
                <Style TargetType="Grid">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding ActiveView}" Value="Cars">
                            <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Grid.Style>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="400" MinWidth="350"/>
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0">
                <TextBlock Text="Оберіть автомобіль зі списку"
                           Style="{StaticResource PlaceholderTextStyle}"
                           Visibility="{Binding SelectedCar, Converter={StaticResource InverseNullToVisibilityConverter}}"/>

                <Border Style="{StaticResource DetailsCardStyle}" Visibility="{Binding SelectedCar, Converter={StaticResource NullToVisibilityConverter}}">
                    <Grid>
                        <Button Content="Назад до клієнтів" Command="{Binding BackToClientsCommand}"
                                HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,15,15,0" />

                        <StackPanel Margin="30" DataContext="{Binding SelectedCar}">
                            <TextBlock Text="Марка:" Style="{StaticResource LabelTextStyle}"/>
                            <TextBlock Text="{Binding Brand}" Style="{StaticResource DataTextStyle}" Margin="0,0,0,15"/>
                            <TextBlock Text="Модель:" Style="{StaticResource LabelTextStyle}"/>
                            <TextBlock Text="{Binding Model}" Style="{StaticResource DataTextStyle}" Margin="0,0,0,15"/>
                            <TextBlock Text="VIN-код:" Style="{StaticResource LabelTextStyle}"/>
                            <TextBlock Text="{Binding VIN}" Style="{StaticResource DataTextStyle}" Margin="0,0,0,15"/>
                            <TextBlock Text="Рік випуску:" Style="{StaticResource LabelTextStyle}"/>
                            <TextBlock Text="{Binding Year}" Style="{StaticResource DataTextStyle}" Margin="0,0,0,15"/>
                            <TextBlock Text="Дії з автомобілем:" Style="{StaticResource LabelTextStyle}" Margin="0,20,0,0"/>
                            <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                <Button Content="Замовлення для Авто"
                                        Command="{Binding DataContext.ShowOrdersViewCommand, RelativeSource={RelativeSource AncestorType=Window}}" />
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>

            <Border Grid.Column="1" Background="White" CornerRadius="0,8,8,0">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0">
                        <TextBlock Text="Автомобілі клієнта" Style="{StaticResource HeaderStyle}" />
                        <TextBlock Text="{Binding SelectedClient.FullName}" FontSize="18" Foreground="#555" Margin="0,-15,0,15"/>
                    </StackPanel>

                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBlock Text="Сортувати:" VerticalAlignment="Center" Margin="0,0,5,0" Foreground="#555"/>
                        <ComboBox ItemsSource="{Binding CarSortOptions}"
                                  SelectedItem="{Binding SelectedCarSortOption}"
                                  MinWidth="150"/>
                    </StackPanel>

                    <StackPanel Grid.Row="2" Margin="0,0,0,15">
                        <TextBlock Text="Пошук (Марка, Модель, VIN):" Margin="0,0,0,5" Foreground="#555"/>
                        <TextBox Text="{Binding CarSearchText, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>

                    <ListBox Grid.Row="3" ItemsSource="{Binding CarsView}" SelectedItem="{Binding SelectedCar}" Style="{StaticResource ClientListBoxStyle}" HorizontalContentAlignment="Stretch">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Margin="10">
                                    <TextBlock FontWeight="Bold" FontSize="15" Foreground="#333">
                                        <Run Text="{Binding Brand}"/><Run Text=" "/><Run Text="{Binding Model}"/>
                                    </TextBlock>
                                    <TextBlock Text="{Binding VIN}" Foreground="#777" FontSize="12"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <StackPanel Grid.Row="4" Orientation="Horizontal" Margin="0,15,0,0" HorizontalAlignment="Left">
                        <Button Content="Додати Авто" Command="{Binding AddCarCommand}"/>
                        <Button Content="Редагувати Авто" Command="{Binding EditCarCommand}"/>
                        <Button Content="Видалити Авто" Command="{Binding DeleteCarCommand}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <Grid>
            <Grid.Style>
                <Style TargetType="Grid">
                    <Setter Property="Visibility" Value="Collapsed"/>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding ActiveView}" Value="Orders">
                            <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Grid.Style>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="400" MinWidth="350"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Background="White" CornerRadius="8,0,0,8">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0">
                        <TextBlock Text="Історія замовлень для" Style="{StaticResource HeaderStyle}" Margin="0,0,0,-5"/>
                        <TextBlock FontSize="18" Foreground="#555" Margin="0,0,0,15">
                            <Run Text="{Binding SelectedCar.Brand}"/><Run Text=" "/><Run Text="{Binding SelectedCar.Model}"/>
                        </TextBlock>
                    </StackPanel>

                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBlock Text="Сортувати історію:" VerticalAlignment="Center" Margin="0,0,5,0" Foreground="#555"/>
                        <ComboBox ItemsSource="{Binding OrderSortOptions}"
                                  SelectedItem="{Binding SelectedOrderSortOption}"
                                  MinWidth="150"/>
                    </StackPanel>

                    <ListBox Grid.Row="2" ItemsSource="{Binding OrdersView}" SelectedItem="{Binding SelectedOrder}" Style="{StaticResource ClientListBoxStyle}" HorizontalContentAlignment="Stretch">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="10" Margin="0,0,0,5" BorderBrush="#EEE" BorderThickness="0,0,0,1">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <TextBlock Grid.Row="0" Text="{Binding Description}" FontWeight="SemiBold" FontSize="13" Foreground="#333" TextWrapping="Wrap"/>
                                        <TextBlock Grid.Row="1" Foreground="#888" FontSize="11" Margin="0,5,0,0">
                                            <Run Text="Дата: "/><Run Text="{Binding CreationDate, StringFormat='dd.MM.yyyy'}"/>
                                        </TextBlock>
                                        <TextBlock Grid.Row="2" Foreground="#006400" FontSize="11" FontWeight="Bold" Margin="0,2,0,0">
                                            <Run Text="Вартість: "/><Run Text="{Binding Cost, StringFormat='{}{0:F2} грн'}"/>
                                        </TextBlock>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,15,0,0">
                        <Button Content="Очистити історію" Command="{Binding ClearOrderHistoryCommand}"/>
                        <Button Content="Видалити вибране" Command="{Binding DeleteSelectedOrderCommand}" Margin="10,0,0,0"/>
                    </StackPanel>
                </Grid>
            </Border>

            <Grid Grid.Column="1">
                <Border Style="{StaticResource DetailsCardStyle}">
                    <Grid>
                        <Button Content="Назад до авто" Command="{Binding BackToCarsCommand}"
                                HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,15,15,0" />

                        <StackPanel Margin="30">
                            <TextBlock Text="Актуальний стан" Style="{StaticResource HeaderStyle}" />

                            <StackPanel Visibility="{Binding ActiveOrder, Converter={StaticResource InverseNullToVisibilityConverter}}">
                                <TextBlock Text="Наразі активних замовлень немає." TextWrapping="Wrap" Foreground="#008000" Margin="0,0,0,15"/>
                                <TextBlock Text="Нове замовлення" Style="{StaticResource HeaderStyle}" />
                                <Button Content="Створити нове замовлення" Command="{Binding AddOrderCommand}" HorizontalAlignment="Left" />
                            </StackPanel>

                            <Grid DataContext="{Binding ActiveOrder}" Visibility="{Binding ActiveOrder, Converter={StaticResource NullToVisibilityConverter}}">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Text="Опис проблеми:" Style="{StaticResource LabelTextStyle}" />
                                <TextBox Grid.Row="1" Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" TextWrapping="Wrap" Margin="0,0,0,10" MinHeight="60" VerticalScrollBarVisibility="Auto" AcceptsReturn="True"/>

                                <TextBlock Grid.Row="2" Text="Вартість (грн):" Style="{StaticResource LabelTextStyle}" Margin="0,5,0,0"/>
                                <TextBox Grid.Row="3" Text="{Binding Cost, UpdateSourceTrigger=PropertyChanged, StringFormat='{}{0:F2}'}"  Margin="0,0,0,10" />

                                <CheckBox Grid.Row="4" IsChecked="{Binding IsRecurringProblem}" Content="Повторна проблема" VerticalAlignment="Center" Margin="0,0,0,10"/>

                                <TextBlock Grid.Row="5" Text="Статус:" Style="{StaticResource LabelTextStyle}" Margin="0,10,0,5"/>

                                <StackPanel Grid.Row="6">
                                    <RadioButton GroupName="Status" Content="В очікуванні" IsChecked="{Binding Status, ConverterParameter=В очікуванні, Converter={StaticResource EqualityToBooleanConverter}}" Command="{Binding DataContext.SetStatusCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="В очікуванні"/>
                                    <RadioButton GroupName="Status" Content="В роботі" IsChecked="{Binding Status, ConverterParameter=В роботі, Converter={StaticResource EqualityToBooleanConverter}}" Command="{Binding DataContext.SetStatusCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="В роботі"/>
                                    <RadioButton GroupName="Status" Content="Очікує запчастин" IsChecked="{Binding Status, ConverterParameter=Очікує запчастин, Converter={StaticResource EqualityToBooleanConverter}}" Command="{Binding DataContext.SetStatusCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="Очікує запчастин"/>
                                    <RadioButton GroupName="Status" Content="Завершено" IsChecked="{Binding Status, ConverterParameter=Завершено, Converter={StaticResource EqualityToBooleanConverter}}" Command="{Binding DataContext.SetStatusCommand, RelativeSource={RelativeSource AncestorType=Window}}" CommandParameter="Завершено"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
        </Grid>

    </Grid>
</Window>